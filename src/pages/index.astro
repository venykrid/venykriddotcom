---
// Main page
import { Image } from "astro:assets";
import BaseLayout from "../layouts/BaseLayout.astro";
import mainHeroImage from "../images/mainHero/mainHeroScaled.webp";
---

<BaseLayout title="venykrid.com" coverViewport={true}>
  <section class="hero-container" id="hero">
    <Image src={mainHeroImage} alt="Northern lights" class="hero-image" />
    <div class="overlay"></div>
    <div class="shooting-star" , id="star"></div>
    <div class="hero-content">
      <h1 class="hero-title" id="title" aria-label="venykrid">venykrid</h1>
    </div>
  </section>
  <div class="content-wrapper">
    <p>
      I'm a Freshman Computer Science student with a focus on security and reliability using modern standards and
      attention to detail.
    </p>
  </div>
</BaseLayout>

<script>
  const star = document.getElementById("star");

  function fireRandomStar() {
    const top = Math.floor(Math.random() * 30) + "vh";
    const right = Math.floor(Math.random() * 100) + "vw";
    const angle = Math.random() * 360 + "deg";
    const duration = Math.random() * 3 + 1 + "s";
    const delay = Math.random() * 8 + 2 + "s";

    star?.style.setProperty("--star-top", top);
    star?.style.setProperty("--star-right", right);
    star?.style.setProperty("--star-angle", angle);
    star?.style.setProperty("--star-duration", duration);
    star?.style.setProperty("--star-delay", delay);

    star?.classList.remove("animate");
    void star?.offsetWidth;
    star?.classList.add("animate");
  }

  star?.addEventListener("animationend", fireRandomStar);
  fireRandomStar();

  const hero = document.getElementById("hero");
  const title = document.getElementById("title");

  if (title) {
    const text = title.textContent || "";
    title.textContent = "";

    let i = 0;
    function typeWriter() {
      if (i < text.length && title) {
        title.textContent += text.charAt(i);
        i++;
        setTimeout(typeWriter, Math.random() * 100 + 60);
      }
    }
    setTimeout(typeWriter, 300);
  }

  hero?.addEventListener("mousemove", (e) => {
    // 1. Get the viewport dimensions
    const { innerWidth, innerHeight } = window;

    // 2. Calculate mouse position relative to center (-1 to 1)
    const x = (e.clientX / innerWidth - 0.5) * 2;
    const y = (e.clientY / innerHeight - 0.5) * 2;

    // 3. Update CSS variables (multiply by max rotation degrees, e.g., 10)
    title?.style.setProperty("--rot-x", `${y * -10}deg`);
    title?.style.setProperty("--rot-y", `${x * 10}deg`);
  });
</script>

<style>
  .hero-container {
    display: grid;
    grid-template-areas: "stack";
    height: 50dvh;
    width: 100%;

    position: relative;
    overflow: hidden;
  }

  /* Assign all children to the same stack area so they overlap */
  .hero-image,
  .overlay,
  .hero-content {
    grid-area: stack;
  }

  .hero-image {
    width: 100%;
    height: 50vh;
    object-fit: cover; /* Ensures the image fills the space without stretching */
  }

  /* Overlay for contrast */
  .overlay {
    background-color: rgba(0, 0, 0, 0.5); /* 50% opacity black */
    z-index: 1;
  }

  /* Center the text over everything */
  .hero-content {
    z-index: 2; /* Ensures text is above the overlay */
    place-self: center; /* Centers the content in the grid cell */
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: 1rem;

    padding-top: env(safe-area-inset-top, 0px);
  }

  .hero-title {
    font-family: "AdwaitaMono" !important;
    margin: 0;
    /* Font scaling: min, scaling factor, maximum */
    font-size: clamp(4rem, 12vw, 8rem);
    font-weight: 800;
    letter-spacing: -0.1em;
    padding-left: 0.3em;
    padding-right: 0.2em;

    background: linear-gradient(135deg, #ffffff 0%, #b3b9bfe7 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;

    --rot-x: 0deg;
    --rot-y: 0deg;

    /* Add perspective to create depth, then rotate based on JS variables */
    transform: perspective(1000px) rotateX(var(--rot-x)) rotateY(var(--rot-y));
    /* Smooth out the movement slightly */
    transition: transform 0.1s ease-out;
  }

  .hero-title::after {
    content: "|";
    -webkit-text-fill-color: #aab0b5c5;
    animation: blink 1s infinite;
  }

  @keyframes blink {
    10%,
    50% {
      opacity: 1;
    }
    60%,
    100% {
      opacity: 0;
    }
  }

  .shooting-star {
    position: absolute;
    width: 150px;
    height: 2px;
    background: linear-gradient(90deg, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0) 100%);
    transform: rotate(-45deg);
    opacity: 0;
    z-index: 1; /* Changed to 1 so it appears above the image/overlay */

    top: var(--star-top, 10%);
    right: var(--star-right, 10%);
    /* Removed the hardcoded animation property here */
  }

  .shooting-star.animate {
    animation: shoot var(--star-duration, 3s) linear var(--star-delay, 2s) forwards;
  }

  @keyframes shoot {
    0% {
      transform: rotate(var(--star-angle, -45deg)) translateX(0);
      opacity: 0;
    }
    20% {
      opacity: 1;
    }
    100% {
      /* Shoots along its dynamic axis */
      transform: rotate(var(--star-angle, -45deg)) translateX(-1000px);
      opacity: 0;
    }
  }
</style>
